# Forward Codex agent notifications to `noti` via an inline Python helper.
notify = [
  "python3",
  "-c",
  """
import json
import shutil
import subprocess
import sys

def main() -> int:
    if len(sys.argv) < 2:
        return 0
    try:
        notification = json.loads(sys.argv[1])
    except json.JSONDecodeError:
        return 0
    if notification.get("type") != "agent-turn-complete":
        return 0

    if shutil.which("noti") is None:
        return 0

    title = (notification.get("last-assistant-message") or "Codex: Turn complete").strip()
    if not title:
        title = "Codex: Turn complete"

    message = " ".join(notification.get("input-messages") or []).strip()
    if not message:
        thread = notification.get("thread-id") or ""
        message = f"Thread {thread} finished.".strip()

    try:
        subprocess.run(
            ["noti", "-t", title, "-m", message],
            check=False,
            stdout=subprocess.DEVNULL,
            stderr=subprocess.DEVNULL,
        )
    except FileNotFoundError:
        return 0
    return 0


if __name__ == "__main__":
    raise SystemExit(main())
  """
]

